<% nesting = local_assigns.fetch(:nesting, 1) %>
<% max_nesting = local_assigns[:max_nesting] %>

<div class="border-left pl-4 mt-4">
  <strong><%= comment.user.name %></strong> posted
  <%= simple_format comment.body %>

  <div data-controller="reply">
    <small>
      <%= nesting > max_nesting %>
      <%= max_nesting %>
      <%= link_to "Reply", "#", data: { action: "click->reply#toggle" } %>
      <%= link_to "Delete", [comment.commentable, comment], method: :delete, data: { confirm: "Are you sure?" } if comment.user = current_user %>
    </small>
    <%= render partial: "comments/form", locals: { 
      commentable: comment.commentable, 
      parent_id: comment.id, 
      class: "mt-4 d-none", 
      target: "reply.form"
    } %>
  </div>

  <%= render comment.comments, nesting: nesting + 1, max_nesting: local_assigns[:max_nesting] %>
</div>